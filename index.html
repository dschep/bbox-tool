<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,height=device-height, user-scalable=no"
    />
    <title>bbox-tool</title>
    <link
      rel="stylesheet"
      href="https://npmcdn.com/leaflet@1.3.4/dist/leaflet.css"
    />
    <script src="https://npmcdn.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <script src="https://npmcdn.com/leaflet.path.drag/src/Path.Drag.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-editable/1.2.0/Leaflet.Editable.min.js"></script>

    <style type="text/css">
      html,
      body,
      #wrapper,
      #map {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
      }
      #wrapper {
        display: flex;
        flex-direction: column;
      }
      #panel {
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <div id="wrapper">
      <div id="panel">
        <label>
          Format:
          <select id="format">
            <option value="--bbox">--bbox</option>
            <option value="minmax">--x_min --y_min --x_max --y_max</option>
            <option value="ST_MakeEnvelope">ST_MakeEnvelope</option>
            <option value="WKT">WKT</option>
          </select>
        </label>
        <pre id="output" />
      </div>
      <div id="map"></div>
    </div>
  </body>
  <script type="text/javascript">
    const mapToHash = function(map) {
      const center = map.getCenter(),
        zoom = map.getZoom(),
        precision = Math.max(0, Math.ceil(Math.log(zoom) / Math.LN2));

      window.location.hash =
        "#" +
        [
          zoom,
          center.lat.toFixed(precision),
          center.lng.toFixed(precision)
        ].join("/");
    };
    const hashToMap = function(map, center = [40, -100], zoom = 5) {
      hash = window.location.hash;
      if (hash.indexOf("#") === 0) {
        hash = hash.substr(1);
      }
      var args = hash.split("/");
      if (args.length == 3) {
        var z = parseInt(args[0], 10),
          lat = parseFloat(args[1]),
          lon = parseFloat(args[2]);
        if (!(isNaN(z) || isNaN(lat) || isNaN(lon))) {
          center = new L.LatLng(lat, lon);
          zoom = z;
        }
      }

      map.setView(center, zoom);
    };

    var map = L.map("map", { editable: true }),
      tilelayer = L.tileLayer(
        "http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",
        {
          maxZoom: 20,
          attribution:
            'Data \u00a9 <a href="http://www.openstreetmap.org/copyright"> OpenStreetMap Contributors </a> Tiles \u00a9 HOT'
        }
      ).addTo(map);
    hashToMap(map);
    mapToHash(map);
    map.on("moveend", () => mapToHash(map));
    window.addEventListener("hashchange", () => hashToMap(map));

    var rec = L.rectangle([[50, -115], [45, -105]]).addTo(map);
    rec.enableEdit();

    const updateOutput = function() {
      const format = document.getElementById("format").value;
      const output = document.getElementById("output");
      bounds = rec.getBounds();
      if (format == "ST_MakeEnvelope") {
        output.textContent = `ST_MakeEnvelope(${bounds._southWest.lng}, ${bounds._southWest.lat}, ${bounds._northEast.lng}, ${bounds._northEast.lat}, 4326)`;
      } else if (format == "WKT") {
        output.textContent = `POLYGON ((${bounds._southWest.lng} ${bounds._southWest.lat}, ${bounds._southWest.lng} ${bounds._northEast.lat}, ${bounds._northEast.lng} ${bounds._northEast.lat}, ${bounds._northEast.lng} ${bounds._southWest.lat}, ${bounds._southWest.lng} ${bounds._southWest.lat}))`;
      } else if (format == "--bbox") {
        output.textContent = `--bbox=${bounds._southWest.lng},${bounds._southWest.lat},${bounds._northEast.lng},${bounds._northEast.lat}`;
      } else if (format == "minmax") {
        output.textContent = `--x_min=${bounds._southWest.lng} --y_min=${bounds._southWest.lat} --x_max=${bounds._northEast.lng} --y_max=${bounds._northEast.lat}`;
      }
    };

    map.on("editable:editing", updateOutput);
    map.on("editable:dragend", updateOutput);
    document.getElementById("format").addEventListener("change", updateOutput);

    updateOutput();
  </script>
</html>
